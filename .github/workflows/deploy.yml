name: deploy
on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-20.04
    environment: production

    steps:
    - name: Checkout
      uses: actions/checkout@v2

#     # 메시지를 출력한다.
#     - name: Run a one-line script
#       run: echo Start server Deploy

#       # 자바 버전을 설정해준다.
#     - name: Set up JDK 1.8
#       uses: actions/setup-java@v1
#       with:
#         java-version: 1.8

#       # Gradle에 실행 권한을 부여한다.
#     - name: Grant execute permission for gradlew
#       run: chmod +x gradlew

#       # Gradle을 활용해 배포한다.
#     - name: Build with Gradle
#       run: ./gradlew clean bootjar

    # AWS 서비스를 사용하기 위한 인증 과정이다.
    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v1
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: ap-northeast-2
        script: |
          cd greenery-db-nginx/
          docker-compose up -d
